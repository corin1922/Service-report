<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="JW Service">
  <meta name="theme-color" content="#7E5EA5">
  
  <!-- iOS í™ˆ í™”ë©´ ì•„ì´ì½˜ -->
  <link rel="apple-touch-icon" sizes="180x180" href="https://cdn.jsdelivr.net/gh/corin1922/Service-report@main/apple-touch-icon/apple-icon-180x180.png">
  
  <!-- ë¸Œë¼ìš°ì € íŒŒë¹„ì½˜ -->
  <link rel="icon" type="image/png" sizes="96x96" href="https://cdn.jsdelivr.net/gh/corin1922/Service-report@main/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/corin1922/Service-report@main/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/corin1922/Service-report@main/favicon/favicon-16x16.png">
  
  <title>JW Service</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-color: #7E5EA5;
      --primary-dark: #6A4D8E;
      --primary-light: #9B7FBF;
      --background: #F5F3F7;
      --card-bg: #FFFFFF;
      --text-primary: #2C2C2C;
      --text-secondary: #6B6B6B;
      --border-color: #E0D9E8;
      --success: #4CAF50;
      --error: #F44336;
      --shadow: 0 2px 8px rgba(126, 94, 165, 0.1);
      --shadow-hover: 0 4px 16px rgba(126, 94, 165, 0.15);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
      background: var(--background);
      color: var(--text-primary);
      line-height: 1.6;
      font-size: 32px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 16px;
    }

    /* í—¤ë” */
    .header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 24px 0;
      box-shadow: var(--shadow);
    }

    .header h1 {
      font-size: 56px;
      font-weight: 600;
      text-align: center;
      letter-spacing: -0.5px;
    }

    /* ë‚´ë¹„ê²Œì´ì…˜ */
    .nav {
      background: var(--card-bg);
      border-bottom: 2px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: var(--shadow);
    }

    .nav-container {
      display: flex;
      justify-content: space-around;
      max-width: 800px;
      margin: 0 auto;
    }

    .nav-item {
      flex: 1;
      padding: 32px 16px;
      text-align: center;
      cursor: pointer;
      color: var(--text-secondary);
      font-weight: 500;
      font-size: 28px;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }

    .nav-item:hover {
      background: var(--background);
      color: var(--primary-color);
    }

    .nav-item.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
      background: var(--background);
    }

    /* ì»¨í…ì¸  ì˜ì—­ */
    .content {
      padding: 24px 0;
      min-height: calc(100vh - 200px);
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ì¹´ë“œ */
    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      transition: box-shadow 0.3s ease;
    }

    .card:hover {
      box-shadow: var(--shadow-hover);
    }

    .card-title {
      font-size: 40px;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--primary-color);
    }

    /* í¼ ìš”ì†Œ */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-primary);
      font-size: 28px;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 24px 32px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 32px;
      transition: all 0.3s ease;
      background: white;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(126, 94, 165, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }

    /* ë²„íŠ¼ */
    .btn {
      padding: 28px 56px;
      border: none;
      border-radius: 8px;
      font-size: 32px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(126, 94, 165, 0.3);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: var(--text-secondary);
      color: white;
    }

    .btn-secondary:hover {
      background: var(--text-primary);
    }

    .btn-small {
      padding: 16px 32px;
      font-size: 28px;
      width: auto;
      display: inline-block;
      margin-right: 8px;
    }

    /* ì•Œë¦¼ ë©”ì‹œì§€ */
    .message {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.show {
      display: block;
    }

    .message.success {
      background: #E8F5E9;
      color: #2E7D32;
      border-left: 4px solid var(--success);
    }

    .message.error {
      background: #FFEBEE;
      color: #C62828;
      border-left: 4px solid var(--error);
    }

    /* í†µê³„ ì¹´ë“œ */
    .stats-card {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
      color: white;
      text-align: center;
      padding: 32px 24px;
      border-radius: 12px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-hover);
    }

    .stats-year {
      font-size: 32px;
      font-weight: 600;
      margin-bottom: 8px;
      opacity: 0.95;
    }

    .stats-hours {
      font-size: 96px;
      font-weight: 700;
      margin: 12px 0;
    }

    .stats-label {
      font-size: 32px;
      opacity: 0.9;
    }

    /* ìš”ì•½ ê·¸ë¦¬ë“œ */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .summary-item {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      box-shadow: var(--shadow);
      border-top: 3px solid var(--primary-color);
    }

    .summary-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 4px;
    }

    .summary-label {
      font-size: 14px;
      color: var(--text-secondary);
    }

    /* ë‹¬ë ¥ ìŠ¤íƒ€ì¼ */
    .calendar-container {
      margin-bottom: 24px;
    }

    .calendar-header {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      padding: 0 8px;
    }

    .calendar-select {
      padding: 8px 12px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      color: var(--primary-color);
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .calendar-select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(126, 94, 165, 0.1);
    }

    .calendar-select:hover {
      border-color: var(--primary-color);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }

    .calendar-day-header {
      text-align: center;
      padding: 8px;
      font-weight: 600;
      font-size: 28px;
      color: var(--text-secondary);
    }

    .calendar-day-header.sunday {
      color: #E53935;
    }

    .calendar-day-header.saturday {
      color: #1E88E5;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      font-size: 28px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      background: var(--background);
      color: var(--text-primary);
      padding: 8px 4px;
    }

    .calendar-day-number {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .calendar-day-info {
      font-size: 18px;
      line-height: 1.2;
      text-align: center;
    }

    .calendar-day.other-month {
      color: var(--text-secondary);
      opacity: 0.3;
    }

    .calendar-day.today {
      background: var(--primary-light);
      color: white;
      font-weight: 700;
    }

    .calendar-day.has-record {
      background: var(--primary-color);
      color: white;
      font-weight: 600;
    }

    .calendar-day.has-record .calendar-day-number {
      font-weight: 700;
    }

    .calendar-day.has-record .calendar-day-info {
      opacity: 0.95;
    }

    .calendar-day.has-record:hover {
      background: var(--primary-dark);
      transform: scale(1.05);
    }

    .calendar-day.today.has-record {
      background: var(--primary-dark);
      box-shadow: 0 0 0 3px rgba(126, 94, 165, 0.3);
    }

    .calendar-day.sunday {
      color: #E53935;
    }

    .calendar-day.saturday {
      color: #1E88E5;
    }

    .calendar-day.has-record.sunday,
    .calendar-day.has-record.saturday {
      color: white;
    }

    /* ì¼ë³„ ìƒì„¸ ëª¨ë‹¬ */
    .day-detail-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .day-detail-modal.show {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .day-detail-content {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 24px;
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    .day-detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border-color);
    }

    .day-detail-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--primary-color);
    }

    .day-detail-record {
      background: var(--background);
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 12px;
      border-left: 4px solid var(--primary-color);
    }

    .day-detail-record-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .day-detail-record-info {
      display: flex;
      gap: 16px;
      font-size: 14px;
      color: var(--text-secondary);
    }
    .record-list {
      margin-top: 24px;
    }

    .record-item {
      background: var(--card-bg);
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 12px;
      border-left: 4px solid var(--primary-color);
      box-shadow: var(--shadow);
    }

    .record-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .record-date {
      font-weight: 600;
      color: var(--primary-color);
    }

    .record-actions {
      display: flex;
      gap: 8px;
    }

    .record-details {
      display: flex;
      gap: 16px;
      font-size: 14px;
      color: var(--text-secondary);
      flex-wrap: wrap;
    }

    .record-detail {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* ì¬ë°©ë¬¸ ì¹´ë“œ */
    .visit-card {
      background: var(--card-bg);
      padding: 32px;
      border-radius: 8px;
      margin-bottom: 24px;
      box-shadow: var(--shadow);
      border-left: 4px solid var(--primary-light);
    }

    .visit-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .visit-name {
      font-weight: 600;
      font-size: 32px;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .bible-study-badge {
      background: var(--primary-color);
      color: white;
      padding: 4px 16px;
      border-radius: 12px;
      font-size: 24px;
      font-weight: 500;
    }

    .visit-actions {
      display: flex;
      gap: 16px;
    }

    .visit-memo {
      color: var(--text-secondary);
      font-size: 28px;
      line-height: 1.5;
    }

    /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
    .loading {
      display: none;
      text-align: center;
      padding: 40px;
      color: var(--primary-color);
    }

    .loading.show {
      display: block;
    }

    .spinner {
      border: 3px solid var(--border-color);
      border-top: 3px solid var(--primary-color);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 600px) {
      .header h1 {
        font-size: 24px;
      }

      .nav-item {
        padding: 14px 4px;
        font-size: 14px;
      }

      .card {
        padding: 20px 16px;
      }

      .stats-hours {
        font-size: 40px;
      }

      .summary-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .record-details {
        flex-direction: column;
        gap: 8px;
      }
    }

    /* ëª¨ë‹¬ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    .modal.show {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal-content {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 24px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--primary-color);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 28px;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s ease;
    }

    .modal-close:hover {
      background: var(--background);
      color: var(--primary-color);
    }
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.3;
    }

    .empty-state-text {
      font-size: 16px;
    }
  </style>
</head>
<body>
  <!-- í—¤ë” -->
  <div class="header">
    <div class="container">
      <div style="display: flex; align-items: center; justify-content: center; gap: 16px;">
        <img src="https://raw.githubusercontent.com/corin1922/Service-report/refs/heads/main/app-image/JW%20Service.png" alt="JW Service" style="height: 56px; width: auto;">
        <h1>JW Service</h1>
      </div>
      <div id="userInfo" style="text-align: center; margin-top: 8px; font-size: 14px; opacity: 0.9;"></div>
    </div>
  </div>

  <!-- ë‚´ë¹„ê²Œì´ì…˜ -->
  <div class="nav">
    <div class="nav-container">
      <div class="nav-item active" onclick="showSection('home')">í™ˆ</div>
      <div class="nav-item" onclick="showSection('calendar')">ìº˜ë¦°ë”</div>
      <div class="nav-item" onclick="showSection('visits')">ì¬ë°©ë¬¸ ê¸°ë¡</div>
    </div>
  </div>

  <!-- ì»¨í…ì¸  -->
  <div class="content">
    <div class="container">
      <!-- í™ˆ ì„¹ì…˜ -->
      <section id="home" class="section active">
        <div class="card">
          <h2 class="card-title">ì˜¤ëŠ˜ì˜ ë´‰ì‚¬ ê¸°ë¡</h2>
          
          <div id="homeMessage" class="message"></div>

          <div class="form-group">
            <label class="form-label">ë‚ ì§œ</label>
            <input type="date" id="recordDate" class="form-input" style="max-width: 400px;">
          </div>

          <div class="form-group">
            <label class="form-label">ë´‰ì‚¬ ì‹œê°„</label>
            <select id="serviceHours" class="form-select">
              <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">ì„±ì„œ ì—°êµ¬</label>
            <select id="bibleStudies" class="form-select">
              <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            </select>
          </div>

          <button class="btn btn-primary" onclick="saveRecord()">ë´‰ì‚¬ ê¸°ë¡ ì €ì¥</button>
        </div>

        <!-- ì´ë²ˆ ë‹¬ í•©ê³„ -->
        <div class="card" style="padding: 32px 24px; background: linear-gradient(135deg, #9B7FBF 0%, #7E5EA5 100%); color: white;">
          <div style="text-align: center; margin-bottom: 24px;">
            <div style="font-size: 32px; font-weight: 600; margin-bottom: 16px; opacity: 0.95;" id="currentMonthLabel">12ì›”</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 16px;">
              <div>
                <div style="font-size: 32px; opacity: 0.9; margin-bottom: 8px;">ì‹œê°„</div>
                <div style="font-size: 96px; font-weight: 700; margin: 12px 0;" id="thisMonthHours">0</div>
              </div>
              <div>
                <div style="font-size: 32px; opacity: 0.9; margin-bottom: 8px;">ì„±ì„œ ì—°êµ¬</div>
                <div style="font-size: 96px; font-weight: 700; margin: 12px 0;" id="thisMonthStudies">0</div>
              </div>
            </div>
          </div>

          <!-- ì–¸ì–´ ì„ íƒ -->
          <div style="margin-bottom: 20px; text-align: center;">
            <label style="display: inline-flex; align-items: center; gap: 8px; margin-right: 20px; font-size: 28px; cursor: pointer;">
              <input type="radio" name="reportLang" value="ko" checked style="width: 32px; height: 32px; cursor: pointer;">
              <span>í•œêµ­ì–´</span>
            </label>
            <label style="display: inline-flex; align-items: center; gap: 8px; margin-right: 20px; font-size: 28px; cursor: pointer;">
              <input type="radio" name="reportLang" value="en" style="width: 32px; height: 32px; cursor: pointer;">
              <span>English</span>
            </label>
            <label style="display: inline-flex; align-items: center; gap: 8px; font-size: 28px; cursor: pointer;">
              <input type="radio" name="reportLang" value="id" style="width: 32px; height: 32px; cursor: pointer;">
              <span>Indonesia</span>
            </label>
          </div>

          <!-- ì „ì†¡ ë²„íŠ¼ -->
          <button class="btn" style="background: white; color: var(--primary-color); font-weight: 700;" onclick="copyMonthlyReport()">ì „ì†¡</button>
          <div id="copyMessage" style="margin-top: 12px; text-align: center; font-size: 24px; min-height: 32px;"></div>
        </div>

        <!-- ë´‰ì‚¬ ì—°ë„ í•©ê³„ -->
        <div class="stats-card">
          <div class="stats-year" id="serviceYear">2025 ë´‰ì‚¬ ì—°ë„</div>
          <div class="stats-hours" id="yearlyHours">0</div>
          <div class="stats-label">ì‹œê°„</div>
        </div>
      </section>

      <!-- ìº˜ë¦°ë” ì„¹ì…˜ -->
      <section id="calendar" class="section">
        <div class="card">
          <h2 class="card-title">ë‹¬ë ¥</h2>
          
          <div class="calendar-container">
            <div class="calendar-header">
              <select id="calendarYear" class="calendar-select" onchange="onCalendarDateChange()"></select>
              <select id="calendarMonth" class="calendar-select" onchange="onCalendarDateChange()"></select>
            </div>
            
            <div class="calendar-grid" id="calendarGrid">
              <!-- ë‹¬ë ¥ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
          </div>
        </div>

        <div class="card">
          <h2 class="card-title">ì›”ë³„ ê¸°ë¡ ì¡°íšŒ</h2>
          
          <div class="form-group">
            <label class="form-label">ë…„ë„</label>
            <select id="selectYear" class="form-select"></select>
          </div>

          <div class="form-group">
            <label class="form-label">ì›”</label>
            <select id="selectMonth" class="form-select"></select>
          </div>

          <button class="btn btn-primary" onclick="loadMonthlySummary()">ì›”ë³„ ìš”ì•½ ë³´ê¸°</button>
        </div>

        <div id="monthlySummary" style="display: none;">
          <div class="summary-grid">
            <div class="summary-item">
              <div class="summary-value" id="monthlyHours">0</div>
              <div class="summary-label">ì‹œê°„</div>
            </div>
            <div class="summary-item">
              <div class="summary-value" id="monthlyStudies">0</div>
              <div class="summary-label">ì„±ì„œ ì—°êµ¬</div>
            </div>
          </div>

          <div class="card">
            <h3 class="card-title">ì¼ë³„ ê¸°ë¡</h3>
            <div id="dailyRecords"></div>
          </div>
        </div>

        <div id="calendarLoading" class="loading">
          <div class="spinner"></div>
          <div>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
      </section>

      <!-- ì¬ë°©ë¬¸ ê¸°ë¡ ì„¹ì…˜ -->
      <section id="visits" class="section">
        <div class="card">
          <h2 class="card-title">ì¬ë°©ë¬¸ ì •ë³´ ì…ë ¥</h2>
          
          <div id="visitMessage" class="message"></div>

          <div class="form-group">
            <label class="form-label">ì´ë¦„</label>
            <input type="text" id="visitName" class="form-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
          </div>

          <div class="form-group">
            <label class="form-label">ë©”ëª¨</label>
            <textarea id="visitMemo" class="form-textarea" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
          </div>

          <div class="form-group">
            <label class="form-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
              <input type="checkbox" id="visitBibleStudy" style="width: 40px; height: 40px; cursor: pointer;">
              <span>ì„±ì„œ ì—°êµ¬</span>
            </label>
          </div>

          <button class="btn btn-primary" onclick="saveVisit()">ì¬ë°©ë¬¸ ì •ë³´ ì €ì¥</button>
        </div>

        <div class="card">
          <h2 class="card-title">ì¬ë°©ë¬¸ ëª©ë¡</h2>
          <div id="visitList"></div>
        </div>

        <div id="visitLoading" class="loading">
          <div class="spinner"></div>
          <div>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
      </section>
    </div>
  </div>

  <!-- ì¬ë°©ë¬¸ ê¸°ë¡ ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="editVisitModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">ì¬ë°©ë¬¸ ì •ë³´ ìˆ˜ì •</h3>
        <button class="modal-close" onclick="closeEditVisitModal()">Ã—</button>
      </div>
      
      <div class="form-group">
        <label class="form-label">ì´ë¦„</label>
        <input type="text" id="editVisitName" class="form-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
      </div>

      <div class="form-group">
        <label class="form-label">ë©”ëª¨</label>
        <textarea id="editVisitMemo" class="form-textarea" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
      </div>

      <div class="form-group">
        <label class="form-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="checkbox" id="editVisitBibleStudy" style="width: 40px; height: 40px; cursor: pointer;">
          <span>ì„±ì„œ ì—°êµ¬</span>
        </label>
      </div>

      <button class="btn btn-primary" onclick="saveEditedVisit()">ìˆ˜ì • ì™„ë£Œ</button>
    </div>
  </div>

  <!-- ì¼ë³„ ìƒì„¸ ëª¨ë‹¬ -->
  <div id="dayDetailModal" class="day-detail-modal">
    <div class="day-detail-content">
      <div class="day-detail-header">
        <h3 class="day-detail-title" id="dayDetailTitle">12ì›” 16ì¼</h3>
        <button class="modal-close" onclick="closeDayDetail()">Ã—</button>
      </div>
      
      <div id="dayDetailRecords"></div>
    </div>
  </div>

  <!-- ë´‰ì‚¬ ê¸°ë¡ ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="editServiceModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">ë´‰ì‚¬ ê¸°ë¡ ìˆ˜ì •</h3>
        <button class="modal-close" onclick="closeEditServiceModal()">Ã—</button>
      </div>
      
      <div class="form-group">
        <label class="form-label">ë‚ ì§œ</label>
        <input type="date" id="editServiceDate" class="form-input">
      </div>

      <div class="form-group">
        <label class="form-label">ë´‰ì‚¬ ì‹œê°„</label>
        <select id="editServiceHours" class="form-select">
          <option value="">ì„ íƒí•˜ì„¸ìš”</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label">ì„±ì„œ ì—°êµ¬ ìˆ˜</label>
        <select id="editServiceStudies" class="form-select">
          <option value="">ì„ íƒí•˜ì„¸ìš”</option>
        </select>
      </div>

      <button class="btn btn-primary" onclick="saveEditedServiceRecord()">ìˆ˜ì • ì™„ë£Œ</button>
    </div>
  </div>

  <script>
    // âš ï¸ Apps Script Web API URL
    const API_URL = 'https://script.google.com/macros/s/AKfycbySZUlZ23bAlrVSu2vmI1ddi19G1HnSgnknAS3fB8B_nRwbXEELo6_mPJxku44IyxRm/exec';
    const AUTH_URL = 'https://script.google.com/macros/s/AKfycbySZUlZ23bAlrVSu2vmI1ddi19G1HnSgnknAS3fB8B_nRwbXEELo6_mPJxku44IyxRm/exec?page=auth';
    
    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í† í° ê´€ë¦¬
    function getToken() {
      return localStorage.getItem('jw_service_token');
    }
    
    function setToken(token) {
      localStorage.setItem('jw_service_token', token);
    }
    
    function getUserEmail() {
      return localStorage.getItem('jw_service_email');
    }
    
    function setUserEmail(email) {
      localStorage.setItem('jw_service_email', email);
    }
    
    function clearAuth() {
      localStorage.removeItem('jw_service_token');
      localStorage.removeItem('jw_service_email');
    }
    
    // URL íŒŒë¼ë¯¸í„°ì—ì„œ í† í° ì¶”ì¶œ
    function checkAuthCallback() {
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');
      const email = urlParams.get('email');
      
      if (token && email) {
        setToken(token);
        setUserEmail(email);
        // URL íŒŒë¼ë¯¸í„° ì œê±°
        window.history.replaceState({}, document.title, window.location.pathname);
        return true;
      }
      return false;
    }
    
    // ë¡œê·¸ì¸ í•„ìš” ì—¬ë¶€ í™•ì¸
    function checkAuth() {
      const token = getToken();
      const email = getUserEmail();
      
      if (!token || !email) {
        showLoginScreen();
        return false;
      }
      
      return true;
    }
    
    // ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
    function showLoginScreen() {
      const loginHtml = `
        <div style="text-align: center; padding: 100px 20px;">
          <h2 style="color: var(--primary-color); margin-bottom: 20px;">ğŸ” ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h2>
          <p style="color: var(--text-secondary); margin-bottom: 30px;">Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì—¬ ë´‰ì‚¬ ê¸°ë¡ì„ ê´€ë¦¬í•˜ì„¸ìš”.</p>
          <button class="btn btn-primary" onclick="redirectToAuth()" style="max-width: 300px;">Googleë¡œ ë¡œê·¸ì¸</button>
        </div>
      `;
      
      document.querySelector('.container').innerHTML = loginHtml;
    }
    
    // ì¸ì¦ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰íŠ¸
    function redirectToAuth() {
      window.location.href = AUTH_URL;
    }
    
    // API í˜¸ì¶œ í•¨ìˆ˜ (í† í° í¬í•¨)
    async function callAPI(action, params = {}) {
      const token = getToken();
      
      if (!token && action !== 'getUserInfo') {
        redirectToAuth();
        return { success: false, needAuth: true };
      }
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            action: action,
            token: token,
            ...params
          })
        });
        
        const result = await response.json();
        
        // ì¸ì¦ ë§Œë£Œ ì‹œ ì¬ë¡œê·¸ì¸
        if (result.needAuth) {
          clearAuth();
          redirectToAuth();
        }
        
        return result;
      } catch (error) {
        console.error('API í˜¸ì¶œ ì˜¤ë¥˜:', error);
        return { success: false, message: 'API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' };
      }
    }

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      // URL ì½œë°± í™•ì¸
      const authSuccess = checkAuthCallback();
      
      // ì¸ì¦ í™•ì¸
      if (!checkAuth()) {
        return;
      }
      
      // ì¸ì¦ ì„±ê³µ ì‹œ ì•± ì´ˆê¸°í™”
      initializeForm();
      loadUserInfo();
      loadYearlyTotal();
      initCalendar();
    });

    // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
    async function loadUserInfo() {
      const email = getUserEmail();
      
      if (email) {
        const displayName = email.split('@')[0];
        document.getElementById('userInfo').textContent = displayName + 'ë‹˜';
      } else {
        const result = await callAPI('getUserInfo');
        
        if (result.success && result.isAuthenticated) {
          setUserEmail(result.email);
          const displayName = result.email.split('@')[0];
          document.getElementById('userInfo').textContent = displayName + 'ë‹˜';
        }
      }
    }

    // ë‹¬ë ¥ ë³€ìˆ˜
    let currentCalendarYear = new Date().getFullYear();
    let currentCalendarMonth = new Date().getMonth() + 1;
    let calendarRecordDates = [];
    let calendarRecordsData = {};

    // ë‹¬ë ¥ ì´ˆê¸°í™”
    function initCalendar() {
      initCalendarSelects();
      renderCalendar();
      loadCalendarData();
    }

    // ë‹¬ë ¥ ì…€ë ‰íŠ¸ ë°•ìŠ¤ ì´ˆê¸°í™”
    function initCalendarSelects() {
      const yearSelect = document.getElementById('calendarYear');
      const monthSelect = document.getElementById('calendarMonth');
      
      const currentYear = new Date().getFullYear();
      yearSelect.innerHTML = '';
      for (let i = currentYear - 5; i <= currentYear + 5; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i + 'ë…„';
        if (i === currentCalendarYear) option.selected = true;
        yearSelect.appendChild(option);
      }
      
      monthSelect.innerHTML = '';
      for (let i = 1; i <= 12; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i + 'ì›”';
        if (i === currentCalendarMonth) option.selected = true;
        monthSelect.appendChild(option);
      }
    }

    // ë‹¬ë ¥ ë‚ ì§œ ë³€ê²½
    function onCalendarDateChange() {
      currentCalendarYear = parseInt(document.getElementById('calendarYear').value);
      currentCalendarMonth = parseInt(document.getElementById('calendarMonth').value);
      loadCalendarData();
    }

    // ë‹¬ë ¥ ë°ì´í„° ë¡œë“œ
    async function loadCalendarData() {
      const result = await callAPI('getMonthlySummary', {
        year: currentCalendarYear,
        month: currentCalendarMonth
      });
      
      if (result.success) {
        calendarRecordDates = result.recordDates || [];
        calendarRecordsData = {};
        
        result.dailyRecords.forEach(record => {
          calendarRecordsData[record.date] = record;
        });
        
        renderCalendar();
      }
    }

    // ë‹¬ë ¥ ë Œë”ë§
    function renderCalendar() {
      const year = currentCalendarYear;
      const month = currentCalendarMonth;
      
      const firstDay = new Date(year, month - 1, 1);
      const lastDay = new Date(year, month, 0);
      const prevLastDay = new Date(year, month - 1, 0);
      
      const firstDayOfWeek = firstDay.getDay();
      const lastDate = lastDay.getDate();
      const prevLastDate = prevLastDay.getDate();
      
      let html = '';
      
      const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      dayNames.forEach((day, index) => {
        let className = 'calendar-day-header';
        if (index === 0) className += ' sunday';
        if (index === 6) className += ' saturday';
        html += `<div class="${className}">${day}</div>`;
      });
      
      for (let i = firstDayOfWeek - 1; i >= 0; i--) {
        const day = prevLastDate - i;
        html += `<div class="calendar-day other-month"><div class="calendar-day-number">${day}</div></div>`;
      }
      
      const today = new Date();
      const isCurrentMonth = today.getFullYear() === year && today.getMonth() + 1 === month;
      
      for (let day = 1; day <= lastDate; day++) {
        const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayOfWeek = new Date(year, month - 1, day).getDay();
        
        let className = 'calendar-day';
        if (dayOfWeek === 0) className += ' sunday';
        if (dayOfWeek === 6) className += ' saturday';
        if (isCurrentMonth && day === today.getDate()) className += ' today';
        if (calendarRecordDates.includes(dateStr)) className += ' has-record';
        
        const onclick = calendarRecordDates.includes(dateStr) ? `onclick="showDayDetail('${dateStr}')"` : '';
        
        let dayInfo = '';
        if (calendarRecordsData[dateStr]) {
          const record = calendarRecordsData[dateStr];
          dayInfo = `<div class="calendar-day-info">${record.hours}h ${record.bibleStudies}s</div>`;
        }
        
        html += `<div class="${className}" ${onclick}>
          <div class="calendar-day-number">${day}</div>
          ${dayInfo}
        </div>`;
      }
      
      const remainingDays = 42 - (firstDayOfWeek + lastDate);
      for (let day = 1; day <= remainingDays; day++) {
        html += `<div class="calendar-day other-month"><div class="calendar-day-number">${day}</div></div>`;
      }
      
      document.getElementById('calendarGrid').innerHTML = html;
    }

    // ì¼ë³„ ìƒì„¸ ë³´ê¸°
    function showDayDetail(dateStr) {
      const record = calendarRecordsData[dateStr];
      if (!record) return;
      
      const modal = document.getElementById('dayDetailModal');
      const date = new Date(dateStr);
      const dateText = `${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;
      
      document.getElementById('dayDetailTitle').textContent = dateText;
      
      const recordsHtml = record.records.map(r => `
        <div class="day-detail-record">
          <div class="day-detail-record-header">
            <div class="day-detail-record-info">
              <span>â±ï¸ ${r.hours}ì‹œê°„</span>
              <span>ğŸ“– ${r.bibleStudies}ëª…</span>
            </div>
            <div>
              <button class="btn btn-secondary btn-small" onclick="editServiceRecordFromDay(${r.id}, '${dateStr}', ${r.hours}, ${r.bibleStudies})">ìˆ˜ì •</button>
              <button class="btn btn-secondary btn-small" onclick="deleteServiceRecordFromDay(${r.id})">ì‚­ì œ</button>
            </div>
          </div>
        </div>
      `).join('');
      
      document.getElementById('dayDetailRecords').innerHTML = recordsHtml;
      modal.classList.add('show');
    }

    // ì¼ë³„ ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
    function closeDayDetail() {
      document.getElementById('dayDetailModal').classList.remove('show');
    }

    // ì¼ë³„ ìƒì„¸ì—ì„œ ìˆ˜ì •
    function editServiceRecordFromDay(id, date, hours, studies) {
      closeDayDetail();
      editServiceRecord(id, date, hours, studies);
    }

    // ì¼ë³„ ìƒì„¸ì—ì„œ ì‚­ì œ
    async function deleteServiceRecordFromDay(id) {
      if (!confirm('ì´ ë´‰ì‚¬ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      
      const result = await callAPI('deleteServiceRecord', { id: id });
      
      if (result.success) {
        closeDayDetail();
        loadCalendarData();
        loadYearlyTotal();
      } else {
        alert(result.message);
      }
    }

    // í¼ ì´ˆê¸°í™”
    function initializeForm() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('recordDate').value = today;

      const hoursSelect = document.getElementById('serviceHours');
      for (let i = 1; i <= 24; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i + 'ì‹œê°„';
        hoursSelect.appendChild(option);
      }

      const studiesSelect = document.getElementById('bibleStudies');
      for (let i = 0; i <= 99; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        studiesSelect.appendChild(option);
      }

      const yearSelect = document.getElementById('selectYear');
      const currentYear = new Date().getFullYear();
      for (let i = currentYear - 5; i <= currentYear + 5; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i + 'ë…„';
        if (i === currentYear) option.selected = true;
        yearSelect.appendChild(option);
      }

      const monthSelect = document.getElementById('selectMonth');
      const currentMonth = new Date().getMonth() + 1;
      for (let i = 1; i <= 12; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i + 'ì›”';
        if (i === currentMonth) option.selected = true;
        monthSelect.appendChild(option);
      }

      // ëª¨ë‹¬ ì…€ë ‰íŠ¸ ë°•ìŠ¤ ì´ˆê¸°í™”
      const editHoursSelect = document.getElementById('editServiceHours');
      for (let i = 1; i <= 24; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i + 'ì‹œê°„';
        editHoursSelect.appendChild(option);
      }

      const editStudiesSelect = document.getElementById('editServiceStudies');
      for (let i = 0; i <= 99; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        editStudiesSelect.appendChild(option);
      }
    }

    // ì„¹ì…˜ ì „í™˜
    function showSection(sectionName) {
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
      });

      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });

      document.getElementById(sectionName).classList.add('active');
      event.target.classList.add('active');

      if (sectionName === 'calendar') {
        loadYearlyTotal();
        initCalendar();
      } else if (sectionName === 'visits') {
        loadVisitList();
      }
    }

    // ë©”ì‹œì§€ í‘œì‹œ
    function showMessage(elementId, message, type) {
      const messageEl = document.getElementById(elementId);
      messageEl.textContent = message;
      messageEl.className = 'message show ' + type;
      setTimeout(() => {
        messageEl.classList.remove('show');
      }, 3000);
    }

    // ë´‰ì‚¬ ê¸°ë¡ ì €ì¥
    async function saveRecord() {
      const date = document.getElementById('recordDate').value;
      const hours = document.getElementById('serviceHours').value;
      const bibleStudies = document.getElementById('bibleStudies').value;

      if (!date) {
        showMessage('homeMessage', 'ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
        return;
      }

      const result = await callAPI('saveServiceRecord', {
        date: date,
        hours: hours,
        bibleStudies: bibleStudies
      });

      if (result.success) {
        showMessage('homeMessage', result.message, 'success');
        document.getElementById('serviceHours').value = '';
        document.getElementById('bibleStudies').value = '';
        loadYearlyTotal();
      } else {
        showMessage('homeMessage', result.message, 'error');
      }
    }

    // ì—°ë„ ì´í•© ë¡œë“œ
    async function loadYearlyTotal() {
      const result = await callAPI('getYearlyTotal');
      
      if (result.success) {
        document.getElementById('serviceYear').textContent = result.year + ' ë´‰ì‚¬ ì—°ë„';
        document.getElementById('yearlyHours').textContent = result.totalHours;
        document.getElementById('thisMonthHours').textContent = result.thisMonthHours;
        document.getElementById('thisMonthStudies').textContent = result.thisMonthStudies;
        document.getElementById('currentMonthLabel').textContent = result.currentMonth + 'ì›”';
        
        const now = new Date();
        window.currentMonthData = {
          year: now.getFullYear(),
          month: now.getMonth() + 1,
          hours: result.thisMonthHours,
          studies: result.thisMonthStudies
        };
      }
    }

    // ì›”ë³„ ë³´ê³ ì„œ í´ë¦½ë³´ë“œ ë³µì‚¬
    function copyMonthlyReport() {
      if (!window.currentMonthData) {
        showCopyMessage('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...', 'error');
        return;
      }

      const lang = document.querySelector('input[name="reportLang"]:checked').value;
      const { year, month, hours, studies } = window.currentMonthData;
      
      const hoursValue = hours || 0;
      const studiesValue = studies || 0;
      
      let report = '';
      
      if (lang === 'ko') {
        report = `${year}ë…„ ${month}ì›” ë´‰ì‚¬ ë³´ê³ 

ì„±ì„œ ì—°êµ¬: ${studiesValue}
ì‹œê°„: ${hoursValue}
ë¹„ê³ : -`;
      } else if (lang === 'en') {
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                           'July', 'August', 'September', 'October', 'November', 'December'];
        report = `FIELD SERVICE REPORT ${monthNames[month - 1]} ${year}

Bible studies: ${studiesValue}
Hours: ${hoursValue}
Comments: -`;
      } else if (lang === 'id') {
        const monthNamesID = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                             'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
        report = `LAPORAN DINAS LAPANGAN ${monthNamesID[month - 1]} ${year}

Pelajaran Alkitab: ${studiesValue}
Jam: ${hoursValue}
Keterangan: -`;
      }

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(report).then(function() {
          showCopyMessage('âœ… í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }, function(err) {
          showCopyMessage('âŒ ë³µì‚¬ ì‹¤íŒ¨', 'error');
        });
      } else {
        const textArea = document.createElement('textarea');
        textArea.value = report;
        textArea.style.position = 'fixed';
        textArea.style.opacity = '0';
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          showCopyMessage('âœ… í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        } catch (err) {
          showCopyMessage('âŒ ë³µì‚¬ ì‹¤íŒ¨', 'error');
        }
        document.body.removeChild(textArea);
      }
    }

    // ë³µì‚¬ ë©”ì‹œì§€ í‘œì‹œ
    function showCopyMessage(message, type) {
      const messageEl = document.getElementById('copyMessage');
      messageEl.textContent = message;
      messageEl.style.opacity = type === 'success' ? '0.95' : '0.8';
      setTimeout(() => {
        messageEl.textContent = '';
      }, 3000);
    }

    // ì›”ë³„ ìš”ì•½ ë¡œë“œ
    async function loadMonthlySummary() {
      const year = document.getElementById('selectYear').value;
      const month = document.getElementById('selectMonth').value;

      document.getElementById('calendarLoading').classList.add('show');
      document.getElementById('monthlySummary').style.display = 'none';

      const result = await callAPI('getMonthlySummary', {
        year: year,
        month: month
      });

      document.getElementById('calendarLoading').classList.remove('show');
      
      if (result.success) {
        document.getElementById('monthlySummary').style.display = 'block';
        document.getElementById('monthlyHours').textContent = result.totalHours;
        document.getElementById('monthlyStudies').textContent = result.totalBibleStudies;

        const dailyRecordsEl = document.getElementById('dailyRecords');
        if (result.dailyRecords.length === 0) {
          dailyRecordsEl.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“…</div><div class="empty-state-text">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div></div>';
        } else {
          dailyRecordsEl.innerHTML = result.dailyRecords.map(record => `
            <div class="record-item">
              <div class="record-header">
                <div class="record-date">${record.date}</div>
                <div class="record-actions">
                  <button class="btn btn-secondary btn-small" onclick="editServiceRecord(${record.records[0].id}, '${record.date}', ${record.hours}, ${record.bibleStudies})">ìˆ˜ì •</button>
                  <button class="btn btn-secondary btn-small" onclick="deleteServiceRecordConfirm(${record.records[0].id})">ì‚­ì œ</button>
                </div>
              </div>
              <div class="record-details">
                <div class="record-detail">â±ï¸ ${record.hours}ì‹œê°„</div>
                <div class="record-detail">ğŸ“– ${record.bibleStudies}ëª…</div>
              </div>
            </div>
          `).join('');
        }
      }
    }

    // ì¬ë°©ë¬¸ ì •ë³´ ì €ì¥
    async function saveVisit() {
      const name = document.getElementById('visitName').value.trim();
      const memo = document.getElementById('visitMemo').value.trim();
      const isBibleStudy = document.getElementById('visitBibleStudy').checked;

      if (!name) {
        showMessage('visitMessage', 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
        return;
      }

      const result = await callAPI('saveReturnVisit', {
        name: name,
        memo: memo,
        isBibleStudy: isBibleStudy
      });

      if (result.success) {
        showMessage('visitMessage', result.message, 'success');
        document.getElementById('visitName').value = '';
        document.getElementById('visitMemo').value = '';
        document.getElementById('visitBibleStudy').checked = false;
        loadVisitList();
      } else {
        showMessage('visitMessage', result.message, 'error');
      }
    }

    // ì¬ë°©ë¬¸ ëª©ë¡ ë¡œë“œ
    async function loadVisitList() {
      document.getElementById('visitLoading').classList.add('show');

      const result = await callAPI('getReturnVisits');
      
      document.getElementById('visitLoading').classList.remove('show');
      
      const visitListEl = document.getElementById('visitList');
      if (result.success) {
        if (result.visits.length === 0) {
          visitListEl.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ‘¥</div><div class="empty-state-text">ì¬ë°©ë¬¸ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div></div>';
        } else {
          visitListEl.innerHTML = result.visits.map(visit => `
            <div class="visit-card">
              <div class="visit-header">
                <div class="visit-name">
                  ${visit.name}
                  ${visit.isBibleStudy ? '<span class="bible-study-badge">ğŸ“– ì„±ì„œ ì—°êµ¬</span>' : ''}
                </div>
                <div class="visit-actions">
                  <button class="btn btn-secondary btn-small" onclick="editVisit(${visit.id}, '${visit.name.replace(/'/g, "\\'")}', '${(visit.memo || '').replace(/'/g, "\\'")}', ${visit.isBibleStudy})">ìˆ˜ì •</button>
                  <button class="btn btn-secondary btn-small" onclick="deleteVisit(${visit.id})">ì‚­ì œ</button>
                </div>
              </div>
              <div class="visit-memo">${visit.memo || 'ë©”ëª¨ ì—†ìŒ'}</div>
            </div>
          `).join('');
        }
      }
    }

    // ì¬ë°©ë¬¸ ê¸°ë¡ ì‚­ì œ
    async function deleteVisit(id) {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      const result = await callAPI('deleteReturnVisit', { id: id });

      if (result.success) {
        showMessage('visitMessage', result.message, 'success');
        loadVisitList();
      } else {
        showMessage('visitMessage', result.message, 'error');
      }
    }

    // ì¬ë°©ë¬¸ ê¸°ë¡ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
    let editingVisitId = null;
    
    function editVisit(id, name, memo, isBibleStudy) {
      editingVisitId = id;
      const modal = document.getElementById('editVisitModal');
      document.getElementById('editVisitName').value = name;
      document.getElementById('editVisitMemo').value = memo;
      document.getElementById('editVisitBibleStudy').checked = isBibleStudy;
      modal.classList.add('show');
    }

    // ì¬ë°©ë¬¸ ê¸°ë¡ ìˆ˜ì • ì €ì¥
    async function saveEditedVisit() {
      const name = document.getElementById('editVisitName').value.trim();
      const memo = document.getElementById('editVisitMemo').value.trim();
      const isBibleStudy = document.getElementById('editVisitBibleStudy').checked;

      if (!name) {
        alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const result = await callAPI('updateReturnVisit', {
        id: editingVisitId,
        name: name,
        memo: memo,
        isBibleStudy: isBibleStudy
      });

      if (result.success) {
        closeEditVisitModal();
        loadVisitList();
        showMessage('visitMessage', result.message, 'success');
      } else {
        alert(result.message);
      }
    }

    // ì¬ë°©ë¬¸ ìˆ˜ì • ëª¨ë‹¬ ë‹«ê¸°
    function closeEditVisitModal() {
      document.getElementById('editVisitModal').classList.remove('show');
      editingVisitId = null;
    }

    // ë´‰ì‚¬ ê¸°ë¡ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
    let editingServiceId = null;
    
    function editServiceRecord(id, date, hours, studies) {
      editingServiceId = id;
      const modal = document.getElementById('editServiceModal');
      document.getElementById('editServiceDate').value = date;
      document.getElementById('editServiceHours').value = hours || '';
      document.getElementById('editServiceStudies').value = studies || '';
      modal.classList.add('show');
    }

    // ë´‰ì‚¬ ê¸°ë¡ ìˆ˜ì • ì €ì¥
    async function saveEditedServiceRecord() {
      const date = document.getElementById('editServiceDate').value;
      const hours = document.getElementById('editServiceHours').value;
      const studies = document.getElementById('editServiceStudies').value;

      if (!date) {
        alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      const result = await callAPI('updateServiceRecord', {
        id: editingServiceId,
        date: date,
        hours: hours,
        bibleStudies: studies
      });

      if (result.success) {
        closeEditServiceModal();
        loadMonthlySummary();
        loadCalendarData();
        loadYearlyTotal();
      } else {
        alert(result.message);
      }
    }

    // ë´‰ì‚¬ ê¸°ë¡ ì‚­ì œ í™•ì¸
    async function deleteServiceRecordConfirm(id) {
      if (!confirm('ì´ ë´‰ì‚¬ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

      const result = await callAPI('deleteServiceRecord', { id: id });

      if (result.success) {
        loadMonthlySummary();
        loadCalendarData();
        loadYearlyTotal();
      } else {
        alert(result.message);
      }
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeEditServiceModal() {
      document.getElementById('editServiceModal').classList.remove('show');
      editingServiceId = null;
    }
  </script>
</body>
</html>
